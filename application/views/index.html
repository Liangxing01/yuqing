<style type="text/css">

  .zhipai{background: url(../../img/zp.png) no-repeat; display: block; width: 119px; height: 34px; text-align: center; line-height: 34px; font-size: 16px; color: white; margin-bottom: 10px;}
  .chuli{background: url(../../img/cl.png) no-repeat; display: block; width: 119px; height: 34px; text-align: center; line-height: 34px; font-size: 16px; color: white; margin-bottom: 10px;}
  .tq{ background: #72d0eb; border-top-left-radius: 4px; border-top-right-radius: 4px; text-align: center;}
  .tq span{ font-size: 1.4em; color: white; line-height: 88px;}
  .tq span b{ font-size: 3.4em; font-weight: normal;}
  .tq span sup{ font-size: 2.0em;}
  .tq p{ font-size: 1.4em;  color: white; margin: 0px;}
  .tq1{ background: #FFFFFF; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; text-align: center;}
  .tq1 span{ font-size: 1.4em; color: #72d0eb; line-height: 88px;}
  .tq1 span b{ font-size: 3.4em; font-weight: normal;}
  .tq1 p{ font-size: 1.4em;  color: #72d0eb; margin: 0px;}
  .xx{ background: url(../../img/index_xx.png) no-repeat -2px -5px;}
  .xxt{ font-size: 2.0em; color: white;}
    .demo-lx{text-align:center;text-decoration: blink}
    #msg tr td a{
      width: 300px;
      display: inline-block;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: red;
    }
    @media only screen and (min-width: 768px) and (max-width: 1200px){
      #msg tr td a{
        width:126px;
      }
    }
    @media only screen and (min-width: 1200px) and (max-width: 1400px){
      #msg tr td a{
        width:156px;
      }
    }
    @media only screen and (max-width: 375px) {
      #msg tr td a{
        width:50px;
      }
    }
    @media only screen and (max-width: 768px) {
      #msg tr td a{
        width:150px;
      }
    }

    /*通知列表样式设置*/
    .m-notification-content{
      position: fixed;

      right: -200px;
      top: 50%;
      transform: translateY(-50%);

      background-color: rgb(6, 181, 181);

      width: 200px;
      height: 300px;
      padding: 6px;
      color: #fff;

      transition: right 0.6s ease-in-out;
      border-radius: 8px 0 0 8px;
      /*overflow-y: auto;*/
    }
    .m-notification-body{
      height: 100%;
      overflow-y: auto;
    }
    .m-notification-title{
      width: 25px;

      position: absolute;

      left: -25px;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgb(6, 181, 181);
      color: #fff;
      text-align: center;
      font-size: 14px;
      padding: 5px;
      cursor: pointer;

      border-radius: 5px 0 0 5px;
      
    }

    .m-notification-list{ overflow-y: auto; }
    .m-notification-num{ 
      display: inline-block; 
      background: #e4393c; 
      color: #fff;
      padding: 0 5px;
      border-radius: 50%;
      position: absolute;
      top: -8px;
      left: -8px;
      font-size: 12px;
    }
    .m-notification-list li{
      background: #72d0eb;
      margin-bottom: 10px;
      border-radius: 5px;
      padding: 0 5px;
    }
    .m-notification-list p{
      display: none;
      text-indent: 2em;
      line-height: 22px;
    }
    .m-notification-time{
      display: block;
      text-align: right;
    }

    .m-notification-listTitle{
      line-height: 26px;
      font-size: 14px;
      padding-left: 8px;
      margin:0;
      text-align: center;
    }
 
    .m-notification-body::-webkit-scrollbar {
        width:10px;
        height:10px;
        background-color: #F5F5F5;  
    }
    .m-notification-body::-webkit-scrollbar-track     {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);  
      border-radius: 10px;  
      background-color: #F5F5F5;
    }
    .m-notification-body::-webkit-scrollbar-thumb{
        border-radius: 10px;  
      -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);  
      background-color: rgb(6, 181, 181); 
    }

</style>
<!-- BEGIN MAIN CONTENT -->
<link href="/css/tasks.css" rel="stylesheet"><!-- TASK CSS-->
<link rel="stylesheet" type="text/css" href="/css/event_analysis.css"> <!-- 事件分析 -->
<script language="javascript" src="/js/public.js"></script>
<script language="javascript" src="/js/echarts.min.js"></script>
      <section id="main-content">
    <!-- BEGIN WRAPPER  -->
        <section class="wrapper site-min-height">
      <!-- BEGIN ROW  -->
        <div class="zhipai js-zhipai">指派任务数</div>
          <div class="row state-overview js-zhipai">
            <div class="col-lg-3 col-sm-6">
                <section class="panel">
                    <div class="symbol">
                        <i class="fa fa-tags blue">
                        </i>
                    </div>
                    <a href="/designate/info_not_handle">
                        <div class="value">
                            <h1 class="count">
                                0
                            </h1>
                            <p>
                                未查看信息数
                            </p>
                        </div>
                    </a>
                </section>
            </div>
            <div class="col-lg-3 col-sm-6">
              <section class="panel">
                <div class="symbol">
                  <i class="fa fa-wrench red">
                  </i>
                </div>
                <div class="value">
                  <h1 class=" count2">
                    0
                  </h1>
                  <p>
                    已指派事件数
                  </p>
                </div>
              </section>
            </div>
            <div class="col-lg-3 col-sm-6">
                <section class="panel">
                    <div class="symbol">
                        <i class="fa fa-check-square yellow">
                        </i>
                    </div>
                    <a href="/designate/event_search">
                        <div class="value">
                            <h1 class=" count3">
                                0
                            </h1>
                            <p>
                                未审核事件数
                            </p>
                        </div>
                    </a>
                </section>
            </div>
            <div class="col-lg-3 col-sm-6">
              <section class="panel">
                <div class="symbol">
                  <i class="fa fa-bookmark-o purple">
                  </i>
                </div>
                <div class="value">
                  <h1 class=" count4">
                    0
                  </h1>
                  <p>
                    已完成事件数
                  </p>
                </div>
              </section>
            </div>
          </div>
       <!-- END ROW  -->
       <!--处理工作数 -->
       <div class="chuli js-chuli">处理任务数</div>
          <div class="row state-overview js-chuli">
            <div class="col-lg-3 col-sm-6">
                <section class="panel">
                    <div class="symbol">
                        <i class="fa fa-tags blue">
                        </i>
                    </div>
                    <a href="/handler/wait_to_handle">
                        <div class="value">
                            <h1 class="count">
                                0
                            </h1>
                            <p>
                                未处理事件数
                            </p>
                        </div>
                    </a>
                </section>
            </div>
            <div class="col-lg-3 col-sm-6">
                <section class="panel">
                    <div class="symbol">
                        <i class="fa fa-wrench red">
                        </i>
                    </div>
                    <a href="/handler/show_doing_list">
                        <div class="value">
                            <h1 class=" count2">
                                0
                            </h1>
                            <p>
                                正在处理事件数
                            </p>
                        </div>
                    </a>
                </section>
            </div>
            <div class="col-lg-3 col-sm-6">
              <section class="panel">
                <div class="symbol">
                  <i class="fa fa-check-square yellow">
                  </i>
                </div>
                <div class="value">
                  <h1 class=" count3">
                    0
                  </h1>
                  <p>
                    已完成事件数
                  </p>
                </div>
              </section>
            </div>
            <div class="col-lg-3 col-sm-6">
              <section class="panel">
                <div class="symbol">
                  <i class="fa fa-bookmark-o purple">
                  </i>
                </div>
                <div class="value">
                  <h1 class=" count4">
                    0
                  </h1>
                  <p>
                    总任务数
                  </p>
                </div>
              </section>
            </div>
          </div>
       <!--处理工作数-->
       
					<div class="row">						
							<div class="col-md-12">
								<section class="panel  zpechart" style="overflow: hidden;">
									<div class="col-md-3">
										<div id="taskNumber" style="width: 100%; height: 350px; position: absolute; z-index: 1111111;" ></div>
									</div>
									<div class="col-md-9">
										<div id="taskNumber2" style="width: 100%; height: 350px;" ></div>
									</div>
								</section>
							</div>
					</div>
       
       <div class="row">
          <div class="col-md-6">
          <!-- START PANEL -->
          <section class="panel">
                <div class="panel-body xx">
                  <a href="#" class="task-thumb xxt" >
                    5
                  </a>
                  <div class="task-thumb-details">
                    <h1>
                      <a href="#">
                        最新消息
                      </a>
                    </h1>
                    <p>
                      最新5条消息记录
                    </p>
                  </div>
                </div>
                <table class="table personal-task">
                  <tbody id="msg">
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                  </tbody>
                </table>
              </section>
          <!-- END PANEL -->
            </div>

            <div class="col-lg-6 col-md-6">
              <section class="panel">
                <div class="panel-body">
                  <a href="#" class="task-thumb">
                    <img src="<{$avatar}>" alt="">
                  </a>
                  <div class="task-thumb-details">
                    <h1>
                      <a href="#">
                        登录日志
                      </a>
                    </h1>
                    <p>
                      最新5条记录<span class="glyphicon glyphicon-chevron-right"></span>
                    </p>
                  </div>
                </div>
                <table class="table table-hover personal-task">
                  <tbody>
                    <{foreach $login as $item}>
                    <tr>
                      <td>
                        <{$item@iteration}>
                      </td>
                      <td>
                        <{$item.ip}>
                      </td>
                      <td>
                        <span class="badge bg-important">
                          <{$item.time}>
                        </span>
                      </td>
                    </tr>
                    <{/foreach}>
                  </tbody>
                </table>
              </section>
            </div>
          </div>
       <!-- END ROW  -->
        <!-- BEGIN ROW  -->

       <!-- END ROW  -->
        <!-- BEGIN ROW  -->

       <!-- END ROW  -->
        </section>
    <!-- END WRAPPER  -->
        <section class="m-notification-content">
              <div class="m-notification-title">
                  通知列表
                  <span class="m-notification-num">
                  </span>
              </div>
              <div class="m-notification-body">
                  <ul class="m-notification-list">
                    
                  </ul>
              </div>
          </section>
      </section>
      <!-- END MAIN CONTENT -->
      
<script src="/js/count.js"></script>
<script src="/assets/morris.js-0.4.3/raphael-min.js" ></script><!-- MORRIS  JS -->
<script>
var now={y:2016,m:11};
var time=new Date();
var end={y:time.getFullYear(),m:time.getMonth()};
var res=[];
while(now.y!=end.y||now.m!=end.m){
  res.push(now.m<10?`${now.y}-0${now.m}`:`${now.y}-${now.m}`);
  now.m++;
  if (now.m==13){
    now.m=1;
    now.y++;
  }
}
res.push(now.m<10?`${now.y}-0${now.m}`:`${now.y}-${now.m}`); 
  get_all_msg();
  getSiteMessage();
	



  //获取历史记录消息
  function get_all_msg(){
    $.ajax({
      url:'/welcome/get_msg',
      type :'get',
      dataType:'json',
      success:function(data){
        if(data){
          var len = data.length;
          var list = '';
          for(var i = 0;i<len;i++){
            list += '<tr>';
            list += '<td></td>';
            switch(data[i].type){
              case '0':
                list += '<td><span class="label label-info">信息上报</span></td>';break;
              case '1':
                list += '<td><span class="label label-primary">事件指派</span></td>';break;
              case '2':
                list += '<td><span class="label label-danger">事件督办</span></td>';break;
            };
            list += '<td><a href="'+data[i].url+'">'+data[i].title+'</a></td>';
            list += '<td><span class="badge bg-important">'+timeToDate(data[i].time*1000)+'</span></td>';
          }
          $('#msg').html(list);
          reload_num();
        }else{
          $('#msg').html('<tr><td style="text-align: center">暂无历史消息</td></tr>')
        }

      }
    })
  }

  $('.m-notification-title').click(function(){
      if($(this).hasClass('active')){
        $(this).removeClass('active');
        $(".m-notification-content").css("right", "-200px");
      }else{
        $(this).addClass('active');
        $('.m-notification-content').css("right", "0");
      }
  })

  $('.m-notification-list').delegate('li', 'click', function(){
      $(this).find('p').animate({
          "height": "toggle"
      }, 200)
  })

  function getSiteMessage(){
      $.ajax({
          url: "/welcome/get_site_message",
          type: "GET",
          dataType: "json",
          success: function(data){
              if( data.length === 0 ){
                $('.m-notification-list').html("<li>暂无更多消息</li>")
              }else{
                var list = '';
                $('.m-notification-num').html(data.length);
                for( var i = 0, len = data.length; i < len; i++){
                  list += '<li>'
                  list += '<h4 class="m-notification-listTitle">' + data[i].title + '</h4>';
                  list += '<p class="m-notification-listCont">'+ data[i].content;
                  list += '<span class="m-notification-time">'+timeToDate(data[i].time*1000)+ '</span>'
                  list += '</p></li>'
                }

                $('.m-notification-list').append(list);
              }
          }
      })
  }
  

  function open_meeting() {
    $.ajax({
      url:'/welcome/open_meeting',
      type :'get',
      dataType:'json',
      success:function(data){

      },
      error:function(){

      }
    });
  }
  
 
  
  
function echart(){
	$.ajax({
		url: '/chart_ctl/get_event_rank_counts_by_month',
		type: 'post',
		dataType: 'json',
		success: function(obj){
			var arr = [];
			obj.map(function(data){
				arr.push({'value': data.count, 'name':data.rank});
			})

			myChart2.setOption({
				series:[
					{data: arr}
				]
			})
		}
	})
	
	
	$.ajax({
		url: '/chart_ctl/get_event_counts_by_month',
		type: 'post',
		dataType: 'json',
		success: function(obj){
      var arr = [];
      var o=obj.shift();
          if (!o) o={time:0};
      for(var time of res ){
        if (o.time==time){
          arr.push(o.event_count);
          o=obj.shift();
          if (!o) o={time:0};
        }else arr.push(0);
      }
			myChart.setOption({
				series:[
					{ name: '上报', data:arr}	
				]
			})
		}
	})
	
	$.ajax({
		url: '/chart_ctl/get_info_counts_by_month',
		type: 'post',
		dataType: 'json',
		success: function(obj){
      var arr = [];
      var o=obj.shift();
          if (!o) o={time:0};
			for(var time of res ){
        if (o.rep_time==time){
          arr.push(o.info_count);
          o=obj.shift();
          if (!o) o={rep_time:0};
        }else arr.push(0);
      }
			myChart.setOption({
        series:[
          { name: '指派', data:arr} 
        ]
      })
		}
	})
	
}
echart();



	var myChart2 = echarts.init(document.getElementById('taskNumber'));
	var option2	= { 
    tooltip : {
        trigger: 'item',
        formatter: "{a} <br/>{b} <br/> {c} ({d}%)"
    },
    color:['#f59a3d ', '#ffd778 ','#83cae0 ','#13b5b1'] ,
    calculable : true,

    series : [
        {
            name:'访问来源',
            type:'pie',
            radius : '50%',
            center: ['55%', '50%'],
            itemStyle:{ 
            	normal: { 
            		label: { 
            			show: true, 
            			formatter: function(params){
            				return params.name[0];
            			}
            		},
           	},
            data:[]
        	}
        }
    ] 
	}
myChart2.setOption(option2);
  var myChart = echarts.init(document.getElementById('taskNumber2'));
	var option1 = {
	    tooltip : {
	        trigger: 'axis'
	    },
	    calculable : true,
	    legend: {
	        data:['上报','指派']
	    },
	    xAxis : [
	        {
	            type : 'category',
	            splitLine : {show : false},
	            axisLine: {
                    lineStyle: {
                        type: 'solid',
                        color: '#72d0eb',//左边线的颜色
                        width:'2'//坐标线的宽度
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: '#72d0eb',//坐标值得具体的颜色

                    }
                },
	            data :res
	        }
	    ],
	    yAxis : [
	        {
	            type : 'value',
	            position: 'right',
	            axisLine: {
                    lineStyle: {
                        type: 'solid',
                        color: '#72d0eb',//左边线的颜色
                        width:'2'//坐标线的宽度
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: '#72d0eb',//坐标值得具体的颜色

                    }
                },
	        }
	    ],
	    series : [
	     {
	            name:'上报',
	            type:'bar',
	            label: {
			            normal: {
			                show: true,
			                position: 'top'
			            }
			        },
			         itemStyle: {
			            normal: {
			                barBorderRadius: 10,
			                color:'#45a0c9'
			            },
			            emphasis: {
			                barBorderRadius: 10
			            }
					    },
	            data:[]
	        },
	    		{
	            name:'指派',
	            type:'bar',
	            label: {
			            normal: {
			                show: true,
			                position: 'top'
			            }
			        },
			         itemStyle: {
			            normal: {
			                barBorderRadius: 10,
			                color: '#00c6c4'
			            },
			            emphasis: {
			                barBorderRadius: 10
			            }
			        },
	            data:[]
	      },
	    ]
	};
	myChart.setOption(option1);
	
	 $.getJSON('/welcome/get_all_tasks_num','',function(data){
			if (typeof data.zp!='undefined'){
			$('.zpechart').show();

			}else {
				$('.zpechart').hide();
			}
	  })
	
	
	/*window.onresize = myChart2.resize;
	window.onresize = myChart.resize;*/


</script>